(this["webpackJsonpskif-map"]=this["webpackJsonpskif-map"]||[]).push([[0],{102:function(e,t){},104:function(e,t){},119:function(e,t){},121:function(e,t){},145:function(e,t){},146:function(e,t){},148:function(e,t){},150:function(e,t){},186:function(e,t,c){"use strict";c.r(t);var n=c(0),s=c.n(n),r=c(33),a=c.n(r),i=(c(94),c(45)),l=c.n(i),o=c(83),d=c(15),j=(c(96),c(48),c(34)),h=c(188),b=c(189),u=c(190),x=c(191),m=c(192),O=(c(97),c(98),c(84)),f=c(1);function g(e){var t=e.selected,c=e.mqttData,n=Object(h.a)();if(console.log("MOOOVE"),console.log(t),0==Object.keys(c).length&&t){var s=p(t.jdata.latlon);n.setView(s,n.getZoom(),{animate:!0})}return null}function p(e){if(void 0!=e){var t=e.lastIndexOf("(");return e.substring(t+1).slice(0,-1).split(" ").map((function(e){return parseFloat(e)}))}return[40.8054,-74.0241]}var w=function(e){var t=e.access,s=e.watchers,r=Object(n.useState)({}),a=Object(d.a)(r,2),i=a[0],l=a[1],o=e.selected,h=c(159);Object(n.useEffect)((function(){var e=t.id,c=s.map((function(e){return"debug/".concat(e.topic,"/addr/1")})),n={clientId:e,password:e,username:t.id_user,connectTimeout:500},r=O.connect("wss://skifgate.ru/ws",n);return r.on("connect",(function(){c.forEach((function(e){console.log("subscribe to ".concat(e)),r.subscribe(e)}))})),r.on("error",(function(e){console.error(e)})),r.on("message",(function(e,t){var c=JSON.parse(t.toString()),n=s.find((function(e){return h(e.jdata.imei.toString())==c.imei_md5.replaceAll("-","")}));c.watcher=n;var r=c.imei_md5,a=Object.assign(Object(j.a)({},r,c),i);console.log(a),l(a)})),function(){r&&(c.forEach((function(e){r.unsubscribe(e)})),r.end(r))}}),[t,s]);var w=p(s[0].jdata.latlon);function v(e){var t=e.watcher,c=p(t.jdata.latlon),n=t.jdata,s=h(t.jdata.imei.toString()),r=!0;return Object.keys(i).forEach((function(e){e.replaceAll("-","")==s&&(r=!1)})),r?Object(f.jsx)(b.a,{position:c,animate:!1,children:Object(f.jsx)(u.a,{children:Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"\u0418\u043c\u044f"}),": ",t.name]},t.name),Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),": ",t.phone]},t.phone),Object(f.jsxs)("li",{children:["\u0412\u0440\u0435\u043c\u044f: ",n.datepoint]},n.datepoint),Object(f.jsxs)("li",{children:["\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c: ",n.speedkph]},n.speedkph),Object(f.jsxs)("li",{children:["\u0417\u0430\u0440\u044f\u0434: ",n.pwr_ext]},n.pwr_ext)]})})}):Object(f.jsx)(f.Fragment,{})}return Object(f.jsxs)(x.a,{center:w,zoom:5,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},children:[Object(f.jsx)(m.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),Object(f.jsx)(g,{selected:o,mqttData:i}),s.map((function(e){return Object(f.jsx)(v,{watcher:e})})),Object.keys(i).map((function(e){var t=i[e],c=t.latlon;if(void 0!=c){c.lastIndexOf("(");var n=p(c);return Object(f.jsx)(b.a,{position:n,animate:!1,children:Object(f.jsx)(u.a,{children:Object(f.jsxs)("ul",{children:[Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"\u0418\u043c\u044f"}),": ",t.watcher.name]},t.watcher.name),Object(f.jsxs)("li",{children:[Object(f.jsx)("b",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),": ",t.watcher.phone]},t.watcher.phone),Object(f.jsxs)("li",{children:["\u0412\u0440\u0435\u043c\u044f: ",t.datepoint]},t.datepoint),Object(f.jsxs)("li",{children:["\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c: ",t.speedkph]},t.speedkph),Object(f.jsxs)("li",{children:["\u0417\u0430\u0440\u044f\u0434: ",t.pwr_ext]},t.pwr_ext)]})})})}}))]})},v=(c(162),c(85)),k=c.n(v);function y(e){var t;return t=e.isLoading?Object(f.jsxs)("div",{children:[Object(f.jsx)(k.a,{type:"Oval",color:"#00BFFF",height:80,width:80}),Object(f.jsx)("p",{className:"text-lg",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."})]}):Object(f.jsx)("p",{className:"text-red-500 md:antialiased text-lg",children:e.message}),Object(f.jsx)("div",{className:"min-h-screen bg-gray-100 py-6 flex flex-col justify-center sm:py-12",children:Object(f.jsx)("div",{className:"relative py-3 sm:max-w-xl sm:mx-auto",children:Object(f.jsx)("div",{className:"relative px-4 py-10 bg-white shadow-lg sm:rounded-3xl sm:p-20",children:Object(f.jsx)("div",{className:"max-w-md mx-auto",children:t})})})})}var N=c(86),F=c(87);function S(e){var t=e.watchers,c=e.onClick;return Object(f.jsxs)("div",{className:" shadow bg-base-200 drawer drawer-mobile h-screen",children:[Object(f.jsx)("input",{id:"my-drawer",type:"checkbox",className:"drawer-toggle"}),Object(f.jsxs)("div",{className:"flex flex-col drawer-content",children:[Object(f.jsxs)("div",{className:"navbar bg-base-300 lg:hidden",children:[Object(f.jsx)("div",{className:"flex-none ",children:Object(f.jsx)("label",{htmlFor:"my-drawer",class:"btn btn-square btn-ghost",children:Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"inline-block w-6 h-6 stroke-current",children:Object(f.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})})}),Object(f.jsx)("div",{className:"flex flex-row items-center h-8",children:Object(f.jsx)("div",{className:"text-sm font-light tracking-wide text-white-400 uppercase",children:"\u041c\u0435\u0442\u043a\u0438"})})]}),Object(f.jsx)("div",{className:"h-full",children:e.children})]}),Object(f.jsxs)("div",{className:"drawer-side",children:[Object(f.jsx)("label",{htmlFor:"my-drawer",className:"drawer-overlay"}),Object(f.jsxs)("ul",{className:"menu p-4 overflow-y-auto w-80 bg-base-100 text-base-content",children:[Object(f.jsx)("li",{className:"px-5 hidden lg:block",children:Object(f.jsx)("div",{className:"flex flex-row items-center h-8",children:Object(f.jsx)("div",{className:"text-sm font-light tracking-wide text-white-400 uppercase",children:"\u041c\u0435\u0442\u043a\u0438"})})}),t.map((function(e){return Object(f.jsx)("li",{children:Object(f.jsxs)("button",{htmlFor:"my-drawer",className:"w-full relative flex flex-row items-center h-11 focus:outline-none hover:bg-blue-800 dark:hover:bg-gray-600 text-white-600 hover:text-white-800 border-l-4 border-transparent hover:border-blue-500 dark:hover:border-gray-800 pr-6",onClick:function(){c(e)},children:[Object(f.jsx)("span",{className:"inline-flex justify-center items-center ml-4 w-5 h-5",children:Object(f.jsx)(N.a,{icon:F.a})}),Object(f.jsx)("span",{className:"ml-2 text-sm tracking-wide truncate",children:e.name})]})})}))]})]})]})}var C=c(3);var E=function(){c(183);var e,t=Object(C.e)(),s=Object(C.d)(),r=Object(n.useState)({data:{},isFetching:!0,selected:{}}),a=Object(d.a)(r,2),i=a[0],j=a[1];Object(n.useEffect)((function(){var c=new URLSearchParams(t.search);function n(){return(n=Object(o.a)(l.a.mark((function t(){var c,n,s,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://skifgate.ru/api/watchers",{method:"POST",mode:"cors",headers:{token:e,"Access-Control-Allow-Origin":"*"}}).then((function(e){return e.json()})).catch((function(e){console.log(e),j({data:Object.assign({watchers:null},i.data),isFetching:!1})}));case 2:return c=t.sent,t.next=5,fetch("https://skifgate.ru/api/acces",{method:"POST",mode:"cors",headers:{token:e,"Access-Control-Allow-Origin":"*"}}).then((function(e){return e.json()})).catch((function(e){console.log(e),j({data:Object.assign({access:null},i.data),isFetching:!1})}));case 5:n=t.sent,s=n?0==n.status?null:n:null,console.log(c),c?0==c.status?(console.log("second"),r=null):(console.log("third"),r=c):(console.log("first"),r=null),j({data:{access:s,watchers:r},isFetching:!1});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}c.has("token")?(e=c.get("token"),s.replace({search:c.toString()}),function(){n.apply(this,arguments)}()):j({data:{},isFetching:!1,error:{message:"\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0442\u043e\u043a\u0435\u043d \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435"}})}),[]);var h=i.data,b=i.isFetching;return console.log("data"),console.log(h),i.error?Object(f.jsx)(y,{message:i.error.message}):b?Object(f.jsx)(y,{isLoading:!0}):null==h.access?Object(f.jsx)(y,{message:"\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f"}):null==h.watchers?Object(f.jsx)(y,{message:"\u041d\u0435 \u0431\u044b\u043b\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u0435\u043b\u0435\u0439"}):Object(f.jsx)(S,{watchers:h.watchers,onClick:function(e){console.log("Click"),j(Object.assign({selected:e},i))},children:Object(f.jsx)(w,{token:e,access:h.access,watchers:h.watchers,selected:i.selected})})},_=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,193)).then((function(t){var c=t.getCLS,n=t.getFID,s=t.getFCP,r=t.getLCP,a=t.getTTFB;c(e),n(e),s(e),r(e),a(e)}))},A=c(44);a.a.render(Object(f.jsx)(s.a.StrictMode,{children:Object(f.jsx)(A.a,{children:Object(f.jsx)(E,{})})}),document.getElementById("root")),_()},94:function(e,t,c){},96:function(e,t,c){}},[[186,1,2]]]);
//# sourceMappingURL=main.2b4fa782.chunk.js.map