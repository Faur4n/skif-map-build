(this["webpackJsonpskif-map"]=this["webpackJsonpskif-map"]||[]).push([[0],{103:function(e,t){},105:function(e,t){},127:function(e,t){},128:function(e,t){},130:function(e,t){},132:function(e,t){},155:function(e,t,n){"use strict";n.r(t);var c=n(0),s=n.n(c),i=n(25),r=n.n(i),a=(n(78),n(23)),o=n.n(a),l=n(37),u=n(7),j=(n(80),n(38),n(26)),d=n(157),h=n(158),f=n(159),b=n(160),p=(n(81),n(82),n(72)),m=n(1);var O=function(e){var t=e.access,s=e.watchers,i=Object(c.useState)({}),r=Object(u.a)(i,2),a=r[0],o=r[1],l=n(142);Object(c.useEffect)((function(){var e=t.id,n=s.map((function(e){return"debug/".concat(e.topic,"/addr/1")})),c={clientId:e,password:e,username:t.id_user,connectTimeout:500},i=p.connect("wss://skifgate.ru/ws",c);return i.on("connect",(function(){n.forEach((function(e){console.log("subscribe to ".concat(e)),i.subscribe(e)}))})),i.on("error",(function(e){console.error(e)})),i.on("message",(function(e,t){var n=JSON.parse(t.toString()),c=s.find((function(e){return l(e.jdata.imei.toString())==n.imei_md5.replaceAll("-","")}));n.watcher=c;var i=n.imei_md5,r=Object.assign(Object(j.a)({},i,n),a);console.log(r),o(r)})),function(){i&&(n.forEach((function(e){i.unsubscribe(e)})),i.end(i))}}),[t,s]);var O=function(e){if(void 0!=e){var t=e.lastIndexOf("(");return e.substring(t+1).slice(0,-1).split(" ").map((function(e){return parseFloat(e)}))}return[40.8054,-74.0241]},x=O(s[0].jdata.latlon);function w(e){var t=e.watcher,n=O(t.jdata.latlon),c=t.jdata,s=l(t.jdata.imei.toString()),i=!0;return Object.keys(a).forEach((function(e){e.replaceAll("-","")==s&&(i=!1)})),i?Object(m.jsx)(d.a,{position:n,animate:!1,children:Object(m.jsx)(h.a,{children:Object(m.jsxs)("ul",{children:[Object(m.jsxs)("li",{children:[Object(m.jsx)("b",{children:"\u0418\u043c\u044f"}),": ",t.name]},t.name),Object(m.jsxs)("li",{children:[Object(m.jsx)("b",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),": ",t.phone]},t.phone),Object(m.jsxs)("li",{children:["\u0412\u0440\u0435\u043c\u044f: ",c.datepoint]},c.datepoint),Object(m.jsxs)("li",{children:["\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c: ",c.speedkph]},c.speedkph),Object(m.jsxs)("li",{children:["\u0417\u0430\u0440\u044f\u0434: ",c.pwr_ext]},c.pwr_ext)]})})}):Object(m.jsx)(m.Fragment,{})}return Object(m.jsxs)(f.a,{center:x,zoom:5,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},children:[Object(m.jsx)(b.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),s.map((function(e){return Object(m.jsx)(w,{watcher:e})})),Object.keys(a).map((function(e){var t=a[e],n=t.latlon;if(void 0!=n){n.lastIndexOf("(");var c=O(n);return Object(m.jsx)(d.a,{position:c,animate:!1,children:Object(m.jsx)(h.a,{children:Object(m.jsxs)("ul",{children:[Object(m.jsxs)("li",{children:[Object(m.jsx)("b",{children:"\u0418\u043c\u044f"}),": ",t.watcher.name]},t.watcher.name),Object(m.jsxs)("li",{children:[Object(m.jsx)("b",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),": ",t.watcher.phone]},t.watcher.phone),Object(m.jsxs)("li",{children:["\u0412\u0440\u0435\u043c\u044f: ",t.datepoint]},t.datepoint),Object(m.jsxs)("li",{children:["\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c: ",t.speedkph]},t.speedkph),Object(m.jsxs)("li",{children:["\u0417\u0430\u0440\u044f\u0434: ",t.pwr_ext]},t.pwr_ext)]})})})}}))]})};var x=function(){var e=n(145),t=n(154),s=window.location.search,i=e.parse(s).token,r=Object(c.useState)({}),a=Object(u.a)(r,2),j=a[0],d=a[1],h=Object(c.useState)([]),f=Object(u.a)(h,2),b=f[0],p=f[1];return Object(c.useEffect)((function(){function e(){return(e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://skifgate.ru/api/watchers",{method:"POST",mode:"cors",headers:{token:i,"Access-Control-Allow-Origin":"*"}});case 2:e.sent.json().then((function(e){console.log(e),p(e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[i]),Object(c.useEffect)((function(){function e(){return(e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://skifgate.ru/api/acces",{method:"POST",mode:"cors",headers:{token:i,"Access-Control-Allow-Origin":"*"}});case 2:e.sent.json().then((function(e){console.log(e),d(e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[i]),Object(m.jsxs)("div",{className:"min-h-screen relative flex items-center",children:[Object(m.jsxs)("div",{className:"shadow-md border border-black p-6 z-10 bg-white bg-opacity-80 absolute top-0 right-0 flext items-center",children:[Object(m.jsx)("div",{className:"text-xl font-medium text-black text-center",children:"\u041c\u0435\u0442\u043a\u0438"}),Object(m.jsx)("div",{className:"width-auto",children:Object(m.jsx)("hr",{})}),b.map((function(e){return Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{className:"text-l font-medium",children:[e.name," ",Object(m.jsx)("span",{className:"font-semibold",children:e.phone})]}),Object(m.jsxs)("div",{className:"text-l font-medium",children:["\u043e\u0442 ",t(e.date_to,"YYYY-MM-DDThh:mm:ss").format("DD.MM.YY h:mm")," \u0434\u043e ",t(e.date_from,"YYYY-MM-DDThh:mm:ss").format("DD.MM.YY h:mm")]}),Object(m.jsx)("div",{className:"width-auto",children:Object(m.jsx)("hr",{})})]})}))]}),function(){if(void 0!==j.id&&void 0!==b[0])return Object(m.jsx)(O,{token:i,access:j,watchers:b})}()]})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,161)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),i(e),r(e)}))};r.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(x,{})}),document.getElementById("root")),w()},78:function(e,t,n){},80:function(e,t,n){},86:function(e,t){},88:function(e,t){}},[[155,1,2]]]);
//# sourceMappingURL=main.a7c6b111.chunk.js.map